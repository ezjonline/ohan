<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Start Navigator - OHAN</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@500;600;700&family=Source+Sans+3:wght@400;500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css?v=3">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>


</head>

<body>
    <header class="navbar" style="background: transparent; border: none;">
        <div class="container flex justify-between items-center">
            <a href="index.html" class="flex items-center gap-2">
                <img src="logo.png" alt="OHAN Health" class="logo-img">
            </a>
            <nav id="nav-menu" class="nav-menu flex items-center gap-4">
                <div class="lang-selector flex items-center gap-1"
                    style="background: rgba(255,255,255,0.5); padding: 4px 12px; border-radius: 20px; margin-right: var(--spacing-2); cursor: pointer; color: var(--color-text-muted); font-weight: 700; font-size: 0.9rem;">
                    <i data-lucide="globe" style="width: 16px;"></i>
                    <span>EN</span>
                </div>
                <a href="index.html" class="nav-link">Home</a>
                <a href="about.html" class="nav-link">About</a>
                <a href="clinics.html" class="nav-link">Find Clinics</a>
                <a href="partner.html" class="nav-link">Partners</a>
                <a href="navigator.html" class="btn btn-primary active">Start Navigator</a>
            </nav>
        </div>
    </header>



    <main class="section"
        style="min-height: 70vh; display: flex; flex-direction: column; justify-content: center; padding: var(--spacing-12) 0;">
        <div class="container" style="max-width: 1000px; margin: 0 auto; text-align: center;">
            <h1 style="margin-bottom: var(--spacing-3); color: var(--color-primary);">Oral Health Access Navigator</h1>
            <p
                style="font-size: 1.75rem; color: var(--color-text-muted); margin-bottom: var(--spacing-8); font-weight: 500;">
                How can we help you today?
            </p>

            <!-- Botpress Embed Container -->
            <!-- Botpress Embed Container -->
            <div id="webchat" style="width: 100%; height: 600px;"></div>

            <style>
                #webchat .bpWebchat {
                    position: unset;
                    width: 100%;
                    height: 100%;
                    max-height: 100%;
                    max-width: 100%;
                }

                #webchat .bpFab {
                    display: none;
                }
            </style>

            <script>
                // Programmatic Loader for Botpress
                // Ensures strict loading order and eliminates race conditions
                (function () {
                    console.log("Starting Botpress Loader...");

                    const script = document.createElement('script');
                    script.src = 'https://cdn.botpress.cloud/webchat/v3.5/inject.js';
                    script.async = true;

                    script.onload = () => {
                        console.log("Botpress Script Loaded.");

                        // Initialize immediately after load
                        if (window.botpress) {
                            window.botpress.init({
                                botId: "f7782624-6f78-4ff4-b907-d9ebbe87ebd9",
                                clientId: "bd9a65eb-d3cd-488a-bb70-20e710daaac2",
                                selector: "#webchat",
                                configuration: {
                                    version: "v2",
                                    botName: "Oral Health Access Navigator",
                                    botAvatar: "https://files.bpcontent.cloud/2026/01/12/03/20260112034006-3PR33DP7.png",
                                    color: "#258ea6",
                                    variant: "solid",
                                    headerVariant: "glass",
                                    themeMode: "light",
                                    fontFamily: "inter",
                                    radius: 4,
                                    feedbackEnabled: false,
                                    soundEnabled: false,
                                    proactiveMessageEnabled: false,
                                    footer: "[⚡ by Botpress](https://botpress.com/?from=webchat)"
                                }
                            });

                            // Open on ready
                            window.botpress.on("webchat:ready", () => {
                                console.log("Botpress Ready. Opening...");
                                window.botpress.open();
                            });

                            // Polling for DOM Fixes (Inline Layout)
                            // Starts immediately, doesn't wait for ready
                            let attempts = 0;
                            const forceInlineInterval = setInterval(() => {
                                attempts++;
                                const target = document.querySelector("#webchat");
                                const bpContainer = document.querySelector(".bpChatContainer");

                                if (target && bpContainer) {
                                    // 1. Move container
                                    if (bpContainer.parentElement !== target) {
                                        target.appendChild(bpContainer);
                                    }

                                    // 2. Force Styles
                                    target.style.position = "relative";
                                    bpContainer.style.position = "absolute";
                                    bpContainer.style.top = "0";
                                    bpContainer.style.left = "0";
                                    bpContainer.style.width = "100%";
                                    bpContainer.style.height = "100%";
                                    bpContainer.style.zIndex = "10";

                                    // 3. Shadow DOM injection
                                    const allElements = document.querySelectorAll('*');
                                    for (const el of allElements) {
                                        if (el.shadowRoot) {
                                            const css = `
                                                .bpWebchat { 
                                                    position: absolute !important; top: 0 !important; left: 0 !important; 
                                                    width: 100% !important; height: 100% !important; 
                                                    max-height: none !important; margin: 0 !important; transform: none !important;
                                                }
                                                .bpFab { display: none !important; }
                                            `;

                                            // Modern method
                                            try {
                                                const sheet = new CSSStyleSheet();
                                                sheet.replaceSync(css);
                                                el.shadowRoot.adoptedStyleSheets = [...el.shadowRoot.adoptedStyleSheets, sheet];
                                            } catch (e) {
                                                // Fallback
                                                const style = document.createElement('style');
                                                style.textContent = css;
                                                el.shadowRoot.appendChild(style);
                                            }
                                        }
                                    }
                                }

                                // Stop after 15s or if we verified it worked (optional, but safer to keep polling slightly longer)
                                if (attempts > 150) { // 15 seconds
                                    clearInterval(forceInlineInterval);
                                }
                            }, 100);
                        }
                    };

                    script.onerror = () => {
                        console.error("Failed to load Botpress script.");
                    };

                    document.head.appendChild(script);
                })();
            </script>

            <script>
                // Defensive loading: Wait for window.botpress to be defined
                const initBotpress = () => {
                    if (window.botpress) {
                        // 1. Initialize Botpress
                        window.botpress.on("webchat:ready", () => {
                            window.botpress.open();
                        });

                        window.botpress.init({
                            botId: "f7782624-6f78-4ff4-b907-d9ebbe87ebd9",
                            clientId: "bd9a65eb-d3cd-488a-bb70-20e710daaac2",
                            selector: "#webchat",
                            configuration: {
                                version: "v2",
                                botName: "Oral Health Access Navigator",
                                botAvatar: "https://files.bpcontent.cloud/2026/01/12/03/20260112034006-3PR33DP7.png",
                                color: "#258ea6",
                                variant: "solid",
                                headerVariant: "glass",
                                themeMode: "light",
                                fontFamily: "inter",
                                radius: 4,
                                feedbackEnabled: false,
                                soundEnabled: false,
                                proactiveMessageEnabled: false,
                                footer: "[⚡ by Botpress](https://botpress.com/?from=webchat)"
                            }
                        });

                        // 2. Start Polling for Inline Layout (Shadow DOM Fix)
                        const forceInlineInterval = setInterval(() => {
                            const target = document.querySelector("#webchat");
                            const bpContainer = document.querySelector(".bpChatContainer");

                            if (target && bpContainer) {
                                // Move container if not already moved
                                if (bpContainer.parentElement !== target) {
                                    target.appendChild(bpContainer);
                                }

                                // Force inline styles on container
                                target.style.position = "relative";
                                bpContainer.style.position = "absolute";
                                bpContainer.style.top = "0";
                                bpContainer.style.left = "0";
                                bpContainer.style.width = "100%";
                                bpContainer.style.height = "100%";
                                bpContainer.style.zIndex = "10";

                                // Inject styles into ALL Shadow Roots found
                                const allElements = document.querySelectorAll('*');
                                for (const el of allElements) {
                                    if (el.shadowRoot) {
                                        const sheet = new CSSStyleSheet();
                                        sheet.replaceSync(`
                                            .bpWebchat { 
                                                position: absolute !important; 
                                                top: 0 !important; 
                                                left: 0 !important; 
                                                width: 100% !important; 
                                                height: 100% !important; 
                                                max-height: none !important; 
                                                border-radius: 0 !important; 
                                                margin: 0 !important;
                                                transform: none !important;
                                            }
                                            .bpFab { display: none !important; }
                                        `);
                                        try {
                                            el.shadowRoot.adoptedStyleSheets = [...el.shadowRoot.adoptedStyleSheets, sheet];
                                        } catch (e) {
                                            // Fallback
                                            const style = document.createElement('style');
                                            style.textContent = `
                                                .bpWebchat { position: absolute !important; width: 100% !important; height: 100% !important; }
                                                .bpFab { display: none !important; }
                                            `;
                                            el.shadowRoot.appendChild(style);
                                        }
                                    }
                                }
                            }
                        }, 100);

                        // Stop polling after 15 seconds
                        setTimeout(() => clearInterval(forceInlineInterval), 15000);

                    } else {
                        // Retry until defined
                        setTimeout(initBotpress, 50);
                    }
                };

                // Kick off initialization
                initBotpress();
            </script>

            <!-- Disclaimer -->
            <div style="margin-top: var(--spacing-6); font-size: 1rem; color: var(--color-text-light);">
                <p>OHAN is an educational tool and does not provide medical diagnosis or treatment.</p>
            </div>
        </div>
    </main>

    <style>
        @keyframes bounce {

            0%,
            20%,
            50%,
            80%,
            100% {
                transform: translateY(0);
            }

            40% {
                transform: translateY(-10px);
            }

            60% {
                transform: translateY(-5px);
            }
        }
    </style>

    <footer class="footer">
        <div class="container flex flex-col items-center gap-6">
            <a href="index.html" class="flex items-center gap-2">
                <img src="logo.png" alt="OHAN Health" style="height: 48px; opacity: 0.9;">
            </a>
            <div style="font-size: 0.875rem; color: var(--color-text-light);">
                © 2025 OHAN Public Health Project.
            </div>
        </div>
    </footer>


    <script src="script.js"></script>


</body>

</html>